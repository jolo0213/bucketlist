{% extends "base.html" %}

{% block title %} | {{ bucket.bl_name }}{% endblock %}

{% block head %}
{% endblock %}

{% block content %}

<h1>{{ bucket.bl_name }}</h1>

{% if error_message %}<p><strong>{{ error_message }}</strong></p>{% endif %}

<div class="panel panel-default">
    <div class="panel-heading"><b>{{ bucket.bl_name }}</b></div>

    <div class='panel-body'>
        <ul class='list-group'>
            {% for item in bucket.item_set.all %}
                <li class='list-group-item'>
                    {% if item.finish == NULL %}
                        <a href="{% url 'blist:finish' bucket.pk item.pk %}" style='color:green'>
                            <span class="label label-success"><span class="glyphicon glyphicon-check" aria-hidden="true"></span></span>
                        </a>
                        <a href="{% url 'blist:details' bucket.pk item.pk %}">{{ item.item_value }}</a> 
                    {% else %}
                        <a href="{% url 'blist:details' bucket.pk item.pk %}" style='color:green' data-placement="right" data-toggle="tooltip" title="Completed: {{ item.finish }}">
                            {{ item.item_value }}
                        </a>
                    {% endif %}

                    <button type="button" class="btn-xs btn-danger delete pull-right" data-toggle="modal" data-target="#delete" oid='{{ item.pk }}' bid='{{ item.bucket.pk }}'>
                        <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                    </button>

                    <button type="button" class="btn-xs btn-warning edit pull-right" data-toggle="modal" data-target="#edit" oid='{{ item.pk }}' bid='{{ item.bucket.pk }}'>
                        <span class="glyphicon glyphicon-edit" aria-hidden="true"></span>
                    </button> 
                </li>
            {% endfor %}
        </ul>
    </div>
</div>

<div class="panel-group" role="tablist" aria-multiselectable="true">
    <div class='panel panel-default'>
        <div class='panel-heading'>
            <a data-toggle="collapse" href="#collapse-add" aria-expanded="true" aria-controls="collapse-add"><b>Add Item</b></a>
        </div>

        <div id="collapse-add" class="panel-collapse collapse" role="tabpanel">
            <div class='panel-body'>
                <form action="." method="post" id='add-item'>
                    {% csrf_token %}
                    <table class="form-table">
                    <tr>
                        <td>Item Name: </td>
                        <td>{{ form.item_value }}</td>
                    </tr>
                    <tr>
                        <td>URL (optional): </td>
                        <td>{{ form.item_url }}</td>
                    </tr>
                    <tr>
                        <td>Description (optional): </td>
                        <td>{{ form.item_desc }}</td>
                    </tr>
                    </table>
                    <tr><td><input type="submit" value="Add Item"></td></tr>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="panel panel-default">
    <div class="panel-heading"><b>Share This List</b></div>
    <div class="panel-body">
        <div class='well well-sm share'></div>
    </div>
</div>

<a href="/blist/"><button type="button" class="btn btn-primary">
    <span class="glyphicon glyphicon-arrow-left" aria-hidden="true"></span> Back
</button></a>

<!-- Modal dialogs -->

<div class="modal fade" id="delete" tabindex="-1" role="dialog" aria-labelledby="delitem" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="delitem">Delete?</h4>
            </div>
            <div class="modal-body">
                Are you sure you want to delete this item?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger confirm" data-dismiss='modal'>Delete</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="edit" tabindex="-1" role="dialog" aria-labelledby="edititem" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="edititem">Edit</h4>
            </div>
            <div class="modal-body">
                Edit Form will go here!
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss='modal'>Okay</button>
            </div>
        </div>
    </div>
</div>

<!-- Additional Javascript -->

<script>
$('.confirm').click(function() {
    $.ajax({
        url: '/blist/' + $bid + '/' + $oid + '/delete/', 
        method: 'POST',
        success: function() {
            $('.delete[oid=' + $oid + ']').closest('li').remove();
        },
    })
});

$('.delete').click(function() {
    $oid = $(this).attr('oid');
    $bid = $(this).attr('bid');
});

$('.edit').click(function() {
    $oid = $(this).attr('oid');
    $bid = $(this).attr('bid');
});

var share = window.location.href;

$(document).ready(function(){
    $('.share').append(share + 'share/');
});
</script>

{% endblock %}
