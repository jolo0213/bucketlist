{% extends "base.html" %}

{% block title %} | {{ bucket.bl_name }}{% endblock %}

{% block head %}
{% endblock %}

{% block content %}

<div class="panel panel-default">
    <div class="panel-heading"><h4>{{ bucket.bl_name }}</h4></div>
</div>

<div class="panel panel-default">
    <div class="panel-heading"><b>{{ bucket.bl_name }}</b></div>

    <div class='panel-body'>
        <table class='table table-striped table-condensed' id='ItemTable'>
            <tr>
                <th style="text-align:center" width="5%">Done</th>
                <th width='20%'>Name</th>
                <th width='25%'>URL</th>
                <th width='45%'>Description</th>
                <th style='text-align:center' width="5%">Delete</th>
            {% for item in bucket.item_set.all %}
                {% include 'blist/item_table.html' %}
            {% endfor %}
        </table>
    </div>

    <div class='panel-body'>
        <div class="alert alert-success" role="alert"><p>Click on an item name to view its details<br>Click on its fields to edit them</p></div>
    </div>
</div>

<!-- Add Item Form -->

<div class="panel-group" role="tablist" aria-multiselectable="true">
    <div class='panel panel-default'>
        <div class='panel-heading'>
            <a data-toggle="collapse" href="#collapse-add" aria-expanded="true" aria-controls="collapse-add"><b>Add Item</b></a>
        </div>

        <div id="collapse-add" class="panel-collapse collapse" role="tabpanel">
            <div class='panel-body' id="AddBox">
                <form action="." method="post" id='AddItem'>
                    {% csrf_token %}
                    <table class="form-table">
                    <tr>
                        <td>Item Name: </td>
                        <td>{{ form.item_value }}</td>
                    </tr>
                    <tr>
                        <td>URL (optional): </td>
                        <td>{{ form.item_url }}</td>
                    </tr>
                    <tr>
                        <td>Description (optional): </td>
                        <td>{{ form.item_desc }}</td>
                    </tr>
                    </table>
                    <tr><td><input type="submit" class="btn-xs btn-primary" value='Add Item'></td></tr>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="panel panel-default">
    <div class="panel-heading"><b>Share This List</b></div>
    <div class="panel-body">
        <div class='well well-sm share'></div>
    </div>
</div>

<a href="/blist/"><button type="button" class="btn btn-primary">
    <span class="glyphicon glyphicon-arrow-left" aria-hidden="true"></span> Back
</button></a>

<!-- Modal dialogs -->

<div class="modal fade" id="delete" tabindex="-1" role="dialog" aria-labelledby="delitem" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="delitem">Delete?</h4>
            </div>
            <div class="modal-body">
                Are you sure you want to delete this item?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger confirm" data-dismiss='modal'>Delete</button>
            </div>
        </div>
    </div>
</div>

<!-- Additional Javascript -->

<script>
$(document).ready(function(){
    var share = window.location.href;
    share = share.replace(/#/g, '');
    $('.share').append(share + 'share/');
    $('.idesc').editable();
    $('.iurl').editable();
});

$('#AddItem').submit(function() {
    $.ajax({
        type: $('#AddItem').attr('method'),
        url: $('#AddItem').attr('action'),
        data: $('#AddItem').serialize(),
        success: function(data) {
            $('div[role=alert]').remove();
            $('#AddItem')[0].reset();
            $('#ItemTable').append(data);
            $('.idesc').editable();
            $('.iurl').editable();
        },
        error: function() {
            $('#AddBox').append('<br><div class="alert alert-danger" role="alert"><p>Item Name is required</p></div>');
        },
    });
    return false;
});

$('.confirm').click(function() {
    $.ajax({
        url: '/blist/' + $bid + '/' + $oid + '/delete/', 
        method: 'POST',
        success: function() {
            $('.delete[oid=' + $oid + ']').closest('tr').remove();
        },
    })
});

$('#ItemTable').on('click', '.delete', function() {
    $oid = $(this).attr('oid');
    $bid = $(this).attr('bid');
});

$('#ItemTable').on('click', '.finish', function() {
    $oid = $(this).attr('oid');
    $bid = $(this).attr('bid');
    $now = moment().format('MMM. D, YYYY');
    $.ajax({
        url: '/blist/' + $bid + '/' + $oid + '/finish/',
        method: 'POST',
        success: function() {
            if ($("a[oid=" + $oid + "]").attr('fin') == '0') {
                $('a[oid=' + $oid + ']').attr('fin','1');
                $('a[oid=' + $oid + ']').empty();
                $('a[oid=' + $oid + ']').append('<span style="color:green" class="glyphicon glyphicon-check finish" aria-hidden="true" oid="' + $oid + '" bid="' + $bid + '" data-placement="left" data-toggle="tooltip" title="Completed: ' + $now + '"></span> ');
            } else {
                $('a[oid=' + $oid + ']').attr('fin','0');
                $('a[oid=' + $oid + ']').empty();
                $('a[oid=' + $oid + ']').append('<span style="color:#808080" class="glyphicon glyphicon-unchecked finish" aria-hidden="true" oid="' + $oid + '" bid="' + $bid + '"></span> ');
            };
        },
    });
});

</script>

{% endblock %}
