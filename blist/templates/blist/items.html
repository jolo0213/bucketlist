{% extends "base.html" %}

{% block title %} | {{ bucket.bl_name }}{% endblock %}

{% block head %}
{% endblock %}

{% block content %}

<h1>{{ bucket.bl_name }}</h1>

{% if error_message %}<p><strong>{{ error_message }}</strong></p>{% endif %}

<div class="panel panel-default">
    <div class="panel-heading"><b>{{ bucket.bl_name }}</b></div>

    <div class='panel-body'>
        <ul class='list-group'>
            {% for item in bucket.item_set.all %}
                <li class='list-group-item'>
                    {% if item.finish == NULL %}
                        <b><a href="{% url 'blist:finish' bucket.pk item.pk %}" style='color:green'>
                            <span class="label label-success"><span class="glyphicon glyphicon-check" aria-hidden="true"></span></span>
                        </a></b> 
                        <a href="{% url 'blist:details' bucket.pk item.pk %}">{{ item.item_value }}</a> 
                    {% else %}
                        <a href="{% url 'blist:details' bucket.pk item.pk %}" style='color:green' title="Completed: {{ item.finish }}">{{ item.item_value }}</a>
                    {% endif %}
                    <button type="button" class="btn-xs btn-danger delete pull-right" oid='{{ item.pk }}' bid='{{ item.bucket.pk }}'>
                        <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                    </button> 
                    <button type="button" class="btn-xs btn-warning edit pull-right">
                        <span class="glyphicon glyphicon-edit" aria-hidden="true"></span>
                    </button> 
                </li>
            {% endfor %}
        </ul>
    </div>
</div>

<div class="panel-group" role="tablist" aria-multiselectable="true">
    <div class='panel panel-default'>
        <div class='panel-heading'>
            <a data-toggle="collapse" href="#collapse-add" aria-expanded="true" aria-controls="collapse-add"><b>Add Item</b></a>
        </div>

        <div id="collapse-add" class="panel-collapse collapse" role="tabpanel">
            <div class='panel-body'>
                <form action="." method="post" id='add-item'>
                    {% csrf_token %}
                    <table class="form-table">
                    <tr>
                        <td>Item Name: </td>
                        <td>{{ form.item_value }}</td>
                    </tr>
                    <tr>
                        <td>URL (optional): </td>
                        <td>{{ form.item_url }}</td>
                    </tr>
                    <tr>
                        <td>Description (optional): </td>
                        <td>{{ form.item_desc }}</td>
                    </tr>
                    </table>
                    <tr><td><input type="submit" value="Add Item"></td></tr>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="panel panel-default">
    <div class="panel-heading"><b>Share This List</b></div>
    <div class="panel-body">
        <div class='well well-sm share'></div>
    </div>
</div>

<div class='delpop'>Are you sure you want to delete this item?</div>

<div class='editform'>Edit Form will go here!</div>

<a href='/blist/'>Back</a>

<!-- 
The delete item dialog works. Now I would like to add a dialog to edit the item details in a 
modal dialog. Doing this would allow me to reduce the amount of different pages that exist in
this project.

Add form has been converted into a collapsible form that exists on the page.
 -->
<script>
$('.delpop').dialog({
    draggable: false,
    resizable: false,
    width: 450,
    modal: true,
    autoOpen: false,
    buttons: [
        {
            text: "Yes, delete!",
            click: function () {
                $.ajax({
                    url: '/blist/' + $bid + '/' + $oid + '/delete/', 
                    method: 'POST',
                    success: function() {
                        $('.delete[oid=' + $oid + ']').closest('li').remove();
                    },
                    error: function() {
                        $(this).dialog('close');
                    },
                });
                $(this).dialog('close');
            }
        },
        { 
            text: "Nevermind!",
            click: function() {
                $(this).dialog('close');
            }
        }
    ]
})

$('.delete').click(function() {
    $oid = $(this).attr('oid');
    $bid = $(this).attr('bid');
    $('.delpop').dialog('open');
});

$('.editform').dialog({
    draggable: false,
    resizable: false,
    modal: true,
    autoOpen: false,
    buttons: [
        {
            text: 'Okay',
            click: function () {
                $(this).dialog('close')
            }
        }
    ]
})

$('.edit').click(function() {
    $('.editform').dialog('open');
});

var share = window.location.href;

$(document).ready(function(){
    $('.share').append(share + 'share/');
});
</script>

{% endblock %}
