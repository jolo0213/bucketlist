{% extends "base.html" %}

{% block title %} | {{ bucket.bl_name }}{% endblock %}

{% block head %}
{% endblock %}

{% block content %}

<h1>{{ bucket.bl_name }}</h1>

{% if error_message %}<p><strong>{{ error_message }}</strong></p>{% endif %}

<table>
{% for item in bucket.item_set.all %}
    <tr>
    	<td>{% if item.finish == NULL %}
    		<b><a href="{% url 'finish' item.pk %}" style='color:green'>&#x2713;</a></b> 
    		<a href="{% url 'blist:details' item.pk %}">{{ item.item_value }}</a> 
    	{% else %}
    		<a href="{% url 'blist:details' item.pk %}" style='color:green' title="Completed: {{ item.finish }}">{{ item.item_value }}</a>
    	{% endif %}</td>
    	<td><button class='edit'>EDIT</button></td>
        <td><button class='delete' oid='{{ item.pk }}'>&#x2717;</button></td>
    </tr>
{% endfor %}
</table>

<div class='delpop'>Filler</div>

<div class='editform'>Edit Form will go here!</div>

<button class='add'>Ignore For Now</button>

<form action="." method="post" id='add-item'>
	{% csrf_token %}
	<table class="form-table">
	<tr>
    	<td>Item Name: </td>
    	<td>{{ form.item_value }}</td>
	</tr>
	<tr>
    	<td>URL (optional): </td>
    	<td>{{ form.item_url }}</td>
	</tr>
	<tr>
    	<td>Description (optional): </td>
    	<td>{{ form.item_desc }}</td>
	</tr>
	</table>
	<tr><td><input type="submit" value="Add Item"></td></tr>
</form>

<div class='addform'>Add Form will go here!</div>

<br><a href='/blist/'>Back</a>

<!-- 
The other function I want to implement on this page are modal dialogs. 
The simplest implementation would be a confirm screen before deleting an item. I need to use AJAX to make the actual change to the database. 
The harder ones would be to create a dialog for adding an item and editing an item. If I can get those to work, I want to refresh just the main section of the page so that the changes are reflected.
 -->
<script>
$('.delpop').dialog({
    modal: true,
    autoOpen: false,
    buttons: [
        {
            text: "Delete",
            click: function () {
                $.ajax({
                    url: '/delete/' + $oid + '/', 
                    method: 'POST',
                    success: function() {
                        $oid.remove();
                    },
                    error: function() {
                        $(this).dialog('close');
                    },
                });
                $(this).dialog('close');
            }
        },
        { 
            text: "Cancel",
            click: function() {
                $(this).dialog('close');
            }
        }
    ]
})

$('.delete').click(function() {
    $oid = $(this).attr('oid');
    alert($oid);
    $('.delpop').dialog('open');
});

$('.editform').dialog({
    modal: true,
    autoOpen: false,
    buttons: [
        {
            text: 'Okay',
            click: function () {
                $(this).dialog('close')
            }
        }
    ]
})

$('.edit').click(function() {
    $('.editform').dialog('open');
});

$('.addform').dialog({
    modal: true,
    autoOpen: false,
    buttons: [
        {
            text: 'Okay',
            click: function () {
                $(this).dialog('close')
            }
        }
    ]
})

$('.add').click(function() {
    $('.addform').dialog('open');
});
</script>

{% endblock %}
