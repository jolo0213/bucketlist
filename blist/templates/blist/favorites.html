{% extends "base.html" %}

{% block content %}

<div class="panel panel-default">
    <div class="panel-heading"><h4>Favorite Lists</h4></div>
</div>

<div class="panel-group" role="tablist" aria-multiselectable="true">
	{% for bucket in bucket_list %}
	<div class='panel panel-default'>
		<div class='panel-heading'>
			<a data-toggle="collapse" href="#{{ bucket.pk }}" aria-expanded="true" aria-controls="{{ bucket.pk }}"><b>{{ bucket.bl_name }}</b></a>
		</div>
		<div id="{{ bucket.pk }}" class="panel-collapse collapse in" role="tabpanel">
			<ul class='list-group itemlist'>
			{% for item in bucket.item_set.all %}
		    	<li class='list-group-item'>
		    		{% if item.finish == NULL %} 
		    			<a href="javascript:void(0);" oid='{{ item.pk }}' fin='0'>
				            <span style='color:#808080' class="glyphicon glyphicon-unchecked finish" aria-hidden="true" oid='{{ item.pk }}' bid='{{ item.bucket.pk }}'></span>
				        </a> {{ item.item_value }}
		    		{% else %}
		    			<a href="javascript:void(0);" oid='{{ item.pk }}' fin='1'>
				            <span style='color:green' class="glyphicon glyphicon-check finish" aria-hidden="true" oid='{{ item.pk }}' bid='{{ item.bucket.pk }}'></span> 
				        </a> <span title="Completed: {{ item.finish }}" data-placement="right" data-toggle="tooltip">{{ item.item_value }}</span>
		    		{% endif %}
		    	</li>
			{% endfor %}
			</ul>
		</div>
	</div>
	{% endfor %}
</div>

<!-- Additional Javascript -->

<script>
$('.itemlist').on('click', '.finish', function() {
    $oid = $(this).attr('oid');
    $bid = $(this).attr('bid');
    $.ajax({
        url: '/blist/' + $bid + '/' + $oid + '/finish/',
        method: 'POST',
        success: function() {
            if ($("a[oid=" + $oid + "]").attr('fin') == '0') {
                $('a[oid=' + $oid + ']').attr('fin','1');
                $('a[oid=' + $oid + ']').css('style','color:green');
                $('a[oid=' + $oid + ']').empty();
                $('a[oid=' + $oid + ']').append('<span style="color:green" class="glyphicon glyphicon-check finish" aria-hidden="true" oid="' + $oid + '" bid="' + $bid + '"></span> ');
            } else {
                $('a[oid=' + $oid + ']').attr('fin','0');
                $('a[oid=' + $oid + ']').css('style','color:#808080');
                $('a[oid=' + $oid + ']').empty();
                $('a[oid=' + $oid + ']').append('<span style="color:#808080" class="glyphicon glyphicon-unchecked finish" aria-hidden="true" oid="' + $oid + '" bid="' + $bid + '"></span> ');
            };
        },
    });
});
</script>

{% endblock %}